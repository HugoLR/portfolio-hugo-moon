---
import { Image, getImage } from 'astro:assets';
import ArrowBottom from '@/assets/icons/arrow-bottom.svg';
import AvatarGhibli from '@/assets/images/avatar_gibli.png';
import AvatarReality from '@/assets/images/avatar_reality.jpeg';
import { getI18N, type Language } from '@/i18n/utils';

const currentLocale = Astro.currentLocale || 'en';
const i18n = getI18N(currentLocale as Language);

const secondaryImageOptimized = await getImage({
  src: AvatarGhibli,
  width: 1024,
  height: 1024,
});
---

<main class="h-full container mx-auto max-w-4xl px-4 flex flex-col justify-center items-center gap-6 md:gap-8">
  <section class="avatar-container cursor-wand relative w-[100px] h-[100px] group">
    <Image
      id="avatar-primary"
      src={AvatarReality}
      loading="eager"
      width={500}
      height={500}
      fetchpriority="high"
      class="rounded-full absolute inset-0 object-cover transition-opacity border border-text-tertiary duration-300 opacity-100"
      alt={i18n.t('welcome.avatar.primary_alt')}
    />
  </section>

  <h1 class="text-2xl font-bold whitespace-nowrap flex items-center gap-2 text-text-primary">
    {i18n.t('welcome.greeting')}
  </h1>

  <a
    href="https://www.linkedin.com/in/hugolr/"
    target="_blank"
    rel="noopener noreferrer"
    class="inline-flex items-center justify-center rounded-2xl px-6 py-2 font-semibold text-lg md:text-xl text-white bg-accent-primary hover:bg-accent-hover transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg"
  >
    {i18n.t('welcome.cta_button')}
  </a>

  <p class="max-w-3xl text-base/8 md:text-lg/8 text-text-primary md:text-center">
    <strong class="text-accent-primary font-bold">Sr. Frontend Developer</strong> {i18n.t('welcome.description')}
  </p>

  <ArrowBottom class="absolute bottom-6 w-8 h-8 z-10 md:w-10 md:h-10 text-accent-primary animate-vertical-bounce" />
</main>

<script define:vars={{ optimizedSecondaryUrl: secondaryImageOptimized.src }} is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const container = document.querySelector('.avatar-container');
    const primaryImg = document.getElementById('avatar-primary');

    if (!container || !primaryImg) {
      return;
    }

    let isShowingSecondary = false;
    let animationTimeout = null;
    let secondaryImg = null;
    let secondaryLoaded = false;

    const createSecondaryImage = () => {
      if (secondaryLoaded) {
        return;
      }

      secondaryImg = document.createElement('img');
      secondaryImg.id = 'avatar-secondary';
      secondaryImg.src = optimizedSecondaryUrl;
      secondaryImg.loading = 'eager';
      secondaryImg.decoding = 'async';
      secondaryImg.className = 'rounded-full absolute inset-0 object-cover transition-opacity border border-text-tertiary duration-300 opacity-0';
      secondaryImg.alt = 'Avatar Ghibli Hugo Luna Reyes';

      container.appendChild(secondaryImg);
      secondaryLoaded = true;
    };

    const handleAvatarClick = () => {
      if (!secondaryLoaded) {
        createSecondaryImage();
      }

      isShowingSecondary = !isShowingSecondary;

      if (animationTimeout !== null) {
        clearTimeout(animationTimeout);
      }

      container.classList.add('animate-tada');

      if (isShowingSecondary && secondaryImg) {
        primaryImg.style.opacity = '0';
        secondaryImg.style.opacity = '1';
      } else {
        primaryImg.style.opacity = '1';
        if (secondaryImg) {
          secondaryImg.style.opacity = '0';
        }
      }

      animationTimeout = window.setTimeout(() => {
        container.classList.remove('animate-tada');
        animationTimeout = null;
      }, 1000);
    };

    container.addEventListener('click', handleAvatarClick);

    const cleanup = () => {
      if (animationTimeout !== null) {
        clearTimeout(animationTimeout);
      }
      container.removeEventListener('click', handleAvatarClick);
    };

    window.addEventListener('beforeunload', cleanup);
  });
</script>